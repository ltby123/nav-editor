<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>å¯¼èˆªç®¡ç†ç³»ç»Ÿç»ˆæç‰ˆ + æ‰¹é‡ä¿®æ”¹ + æ‰¹é‡åˆ é™¤</title>
<style>
body { font-family: "Microsoft YaHei", sans-serif; padding: 20px; background: #f0f2f5; }
h2 { color: #333; margin-bottom: 10px; }
#searchArea { margin-bottom: 10px; }
#searchInput { padding:5px; width:250px; }
button.actionBtn { padding:5px 10px; margin-left:5px; cursor:pointer; border:none; border-radius:5px; color:#fff; }
button.clearBtn{ background:#6c757d; }
button.resetBtn{ background:#28a745; }
button.batchIconBtn{ background:#ffc107; }
button.batchColorBtn{ background:#17a2b8; }
button.batchDeleteBtn{ background:#dc3545; }
#preview { margin-bottom: 20px; padding: 10px; border-bottom: 2px solid #ccc; background: #fff; border-radius: 8px; }
#preview a { margin-right: 10px; text-decoration: none; font-weight: 500; cursor: pointer; padding: 3px 5px; border-radius: 5px; }
#preview a.active { border: 2px solid #007bff; font-weight: bold; }
#nav { user-select: none; }
.nav-item { display: flex; align-items: center; margin-bottom: 3px; padding: 5px; background: #fff; border-radius: 5px; }
.nav-item.dragging { opacity: 0.5; }
.nav-item input { margin-right: 5px; padding: 5px; width: 100px; }
.nav-item input.active { border: 2px solid #007bff; }
.nav-item input.color-input { width: 60px; }
.nav-item button { padding: 5px 8px; border: none; color: #fff; border-radius: 5px; cursor: pointer; }
.nav-item button.delete { background: #dc3545; }
button#addBtn { background:#007bff; }
button#exportBtn { background:#17a2b8; }
#addArea { margin-top: 10px; }
#importFile { margin-left: 5px; }
#emojiPanel { display:none; position:absolute; background:#fff; border:1px solid #ccc; padding:5px; border-radius:5px; max-width:300px; flex-wrap:wrap; z-index:1000;}
#emojiPanel span { cursor:pointer; font-size:18px; margin:2px; }
#colorPicker { display:none; position:absolute; z-index:1000; }
#confirmationDialog { display:none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center; }
#confirmationDialog .dialogBox { background: #fff; padding: 20px; border-radius: 8px; display: flex; flex-direction: column; align-items: center; }
#confirmationDialog button { padding: 8px 15px; margin-top: 10px; }
</style>
</head>
<body>
<h2>å¯¼èˆªç®¡ç†ç³»ç»Ÿç»ˆæç‰ˆ + æ‰¹é‡ä¿®æ”¹ + æ‰¹é‡åˆ é™¤</h2>

<div id="searchArea">
  <input id="searchInput" placeholder="æœç´¢å¯¼èˆªï¼ˆåç§°/è·¯å¾„/å›¾æ ‡ï¼‰">
  <button class="actionBtn clearBtn" id="clearSearch">æ¸…ç©ºæœç´¢</button>
  <button class="actionBtn resetBtn" id="resetOrder">é‡ç½®é¡ºåº</button>
  <button class="actionBtn batchIconBtn" id="batchIconBtn">æ‰¹é‡ä¿®æ”¹å›¾æ ‡</button>
  <button class="actionBtn batchColorBtn" id="batchColorBtn">æ‰¹é‡ä¿®æ”¹é¢œè‰²</button>
  <button class="actionBtn batchDeleteBtn" id="batchDeleteBtn">æ‰¹é‡åˆ é™¤</button>
</div>

<div id="preview"></div>

<div id="editor">
  <div id="nav"></div>
  <hr>
  <div id="addArea">
    <input id="newName" placeholder="å¯¼èˆªåç§°">
    <input id="newPath" placeholder="è·¯å¾„">
    <input id="newIcon" placeholder="å›¾æ ‡/Emoji" readonly>
    <input id="newColor" type="color">
    <button id="addBtn">æ·»åŠ å¯¼èˆª</button>
    <button id="exportBtn">å¯¼å‡ºå¯¼èˆª</button>
    <input type="file" id="importFile" accept=".json">
  </div>
</div>

<div id="emojiPanel"></div>
<input type="color" id="colorPicker">

<!-- åˆ é™¤ç¡®è®¤å¯¹è¯æ¡† -->
<div id="confirmationDialog">
  <div class="dialogBox">
    <h3>ç¡®è®¤åˆ é™¤é€‰ä¸­çš„å¯¼èˆªï¼Ÿ</h3>
    <button id="confirmDeleteBtn">ç¡®è®¤åˆ é™¤</button>
    <button id="cancelDeleteBtn">å–æ¶ˆ</button>
  </div>
</div>

<script>
let defaultWorkers = [
  { name:"é¦–é¡µ", path:"/", icon:"ğŸ ", color:"#007bff" },
  { name:"å…³äºæˆ‘ä»¬", path:"/about", icon:"â„¹ï¸", color:"#17a2b8" }
];
let workers = JSON.parse(localStorage.getItem("workers")) || [...defaultWorkers];

const nav = document.getElementById("nav");
const preview = document.getElementById("preview");
const addBtn = document.getElementById("addBtn");
const newName = document.getElementById("newName");
const newPath = document.getElementById("newPath");
const newIcon = document.getElementById("newIcon");
const newColor = document.getElementById("newColor");
const exportBtn = document.getElementById("exportBtn");
const importFile = document.getElementById("importFile");
const emojiPanel = document.getElementById("emojiPanel");
const colorPicker = document.getElementById("colorPicker");
const searchInput = document.getElementById("searchInput");
const clearSearchBtn = document.getElementById("clearSearch");
const resetOrderBtn = document.getElementById("resetOrder");
const batchIconBtn = document.getElementById("batchIconBtn");
const batchColorBtn = document.getElementById("batchColorBtn");
const batchDeleteBtn = document.getElementById("batchDeleteBtn");

const confirmationDialog = document.getElementById("confirmationDialog");
const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");
const cancelDeleteBtn = document.getElementById("cancelDeleteBtn");

let activeIndex = -1;
let dragSrcIndex = null;
let currentIconInput = null;
let selectedIndexes = new Set();

const emojis = ["ğŸ ", "â„¹ï¸", "ğŸ“„", "ğŸ“", "ğŸ’¡", "ğŸ›’", "â­", "âš™ï¸", "ğŸ“§", "ğŸ”—"];
emojis.forEach(e => {
  const span = document.createElement("span");
  span.textContent = e;
  span.onclick = () => {
    if (currentIconInput) {
      if (batchMode) {
        selectedIndexes.forEach(i => { workers[i].icon = e; });
      } else {
        currentIconInput.value = e;
      }
      batchMode = false;
      selectedIndexes.clear();
      renderNav();
      emojiPanel.style.display = "none";
    }
  };
  emojiPanel.appendChild(span);
});
let batchMode = false;

function save() { localStorage.setItem("workers", JSON.stringify(workers)); }

function renderNav() {
  nav.innerHTML = "";
  preview.innerHTML = "";
  const keyword = searchInput.value.trim().toLowerCase();
  const filtered = workers.filter(item => {
    return item.name.toLowerCase().includes(keyword) ||
           item.path.toLowerCase().includes(keyword) ||
           (item.icon && item.icon.toLowerCase().includes(keyword));
  });

  filtered.forEach((item, index) => {
    const realIndex = workers.indexOf(item);
    const div = document.createElement("div");
    div.className = "nav-item";
    div.draggable = true;

    const selectCheckbox = document.createElement("input");
    selectCheckbox.type = "checkbox";
    selectCheckbox.checked = selectedIndexes.has(realIndex);
    selectCheckbox.onchange = e => {
      if (e.target.checked) selectedIndexes.add(realIndex);
      else selectedIndexes.delete(realIndex);
    };

    const nameInput = document.createElement("input");
    nameInput.value = item.name;
    nameInput.className = (activeIndex === realIndex) ? "active" : "";
    nameInput.oninput = e => { item.name = e.target.value; renderNav(); };
    nameInput.onclick = () => { activeIndex = (activeIndex === realIndex) ? -1 : realIndex; renderNav(); };

    const pathInput = document.createElement("input");
    pathInput.value = item.path;
    pathInput.className = (activeIndex === realIndex) ? "active" : "";
    pathInput.oninput = e => { item.path = e.target.value; renderNav(); };

    const iconInput = document.createElement("input");
    iconInput.value = item.icon;
    iconInput.className = "color-input";
    iconInput.readOnly = true;
    iconInput.onclick = () => {
      currentIconInput = iconInput;
      emojiPanel.style.display = "block";
      emojiPanel.style.left = iconInput.getBoundingClientRect().left + "px";
      emojiPanel.style.top = iconInput.getBoundingClientRect().bottom + "px";
    };

    const deleteBtn = document.createElement("button");
    deleteBtn.className = "delete";
    deleteBtn.textContent = "Ã—";
    deleteBtn.onclick = () => {
      selectedIndexes.clear();
      workers.splice(realIndex, 1);
      renderNav();
    };

    div.append(selectCheckbox, nameInput, pathInput, iconInput, deleteBtn);
    nav.appendChild(div);

    const previewLink = document.createElement("a");
    previewLink.href = item.path;
    previewLink.textContent = item.name;
    previewLink.style.color = item.color;
    previewLink.style.fontWeight = "bold";
    previewLink.style.fontSize = "16px";
    preview.appendChild(previewLink);
  });
}

batchDeleteBtn.onclick = () => {
  if (selectedIndexes.size === 0) return alert("è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„å¯¼èˆªé¡¹");
  confirmationDialog.style.display = "flex";
};

confirmDeleteBtn.onclick = () => {
  workers = workers.filter((_, index) => !selectedIndexes.has(index));
  selectedIndexes.clear();
  renderNav();
  confirmationDialog.style.display = "none";
};

cancelDeleteBtn.onclick = () => { confirmationDialog.style.display = "none"; };

addBtn.onclick = () => {
  const name = newName.value.trim();
  const path = newPath.value.trim();
  const icon = newIcon.value.trim();
  const color = newColor.value;
  if (name && path) {
    workers.push({ name, path, icon, color });
    newName.value = newPath.value = newIcon.value = '';
    renderNav();
  }
};

exportBtn.onclick = () => {
  const jsonStr = JSON.stringify(workers);
  const blob = new Blob([jsonStr], { type: "application/json" });
  const link = document.createElement("a");
  link.href = ç½‘ç«™.createObjectURL(blob);
  link.download = "navigation.json";
  link.click();
};

importFile.onchange = e => {
  const reader = new FileReader();
  reader.onload = () => {
    workers = JSON.parse(reader.result);
    renderNav();
  };
  reader.readAsText(e.target.files[0]);
};

clearSearchBtn.onclick = () => { searchInput.value = ""; renderNav(); };

resetOrderBtn.onclick = () => { workers = [...defaultWorkers]; renderNav(); };

batchIconBtn.onclick = () => { batchMode = true; selectedIndexes.clear(); renderNav(); };

batchColorBtn.onclick = () => {
  const newColor = prompt("è¯·è¾“å…¥é¢œè‰²ä»£ç æˆ–é€‰æ‹©é¢œè‰²", "#ffffff");
  if (newColor) {
    workers.forEach(i => { if (selectedIndexes.has(workers.indexOf(i))) i.color = newColor; });
    renderNav();
  }
};

searchInput.oninput = renderNav;

renderNav();
</script>
</body>
</html>
